OCFL OBJECT VALIDATION REPORT
============================
Object ID: urn:example-3
Object Path: /workspace/objects/obj-001
Validation Date: 2025-11-09
Status: INVALID

VALIDATION ERRORS SUMMARY
==========================
The OCFL object has failed validation with three critical errors related to logical state mismatches in version inventory files:

1. v1/inventory.json has different logical state in its v1 version block than the root inventory.json (OCFL Code: E066)
2. v2/inventory.json has different logical state in its v1 version block than the root inventory.json (OCFL Code: E066)
3. v2/inventory.json has different logical state in its v2 version block than the root inventory.json (OCFL Code: E066)

DETAILED ANALYSIS
=================

STRUCTURE OVERVIEW:
The object contains 3 versions (v1, v2, v3) with their own inventory.json files. The root inventory.json represents the complete state across all versions.

ISSUE IDENTIFICATION:

The validation error code E066 indicates "Different logical state in version block" - this means the version-specific inventory files contain different information about their respective version states compared to what's recorded in the root inventory.json.

INVENTORY COMPARISON:

Root inventory.json:
- head: v3 (correct - points to latest version)
- v1 state: Contains file-1.txt, file-2.txt, file-3.txt
- v2 state: Contains file-1.txt, file-2.txt, file-3.txt (ISSUE: missing file-4.txt update)
- v3 state: Contains file-1.txt, file-2.txt, file-3.txt, file-4.txt (correct state)

v1/inventory.json:
- head: v1 (only has v1 version)
- v1 state: Contains file-1.txt, file-2.txt, file-3.txt (MATCHES root - this is correct)
- MISMATCH: v1/inventory.json doesn't include v2 and v3 versions that root has
- This causes E066 error

v2/inventory.json:
- head: v2
- v1 state: Contains file-1.txt, file-2.txt, file-3.txt (MATCHES root - correct)
- v2 state: Contains file-1.txt, file-2.txt, file-3.txt (ISSUE: missing file-4.txt)
- MISMATCH: Root shows v2 should have file-3.txt, but v2/inventory.json shows file-3.txt only (not file-4.txt)
- v2/inventory.json doesn't include v3 version that root has
- This causes E066 error for both v1 and v2 blocks

v3/inventory.json:
- head: v3
- Contains complete version chain (v1, v2, v3)
- v1 state: MATCHES root
- v2 state: Contains file-3.txt (not file-4.txt) - MISMATCH with root expectations
- v3 state: Contains file-3.txt, file-4.txt (MATCHES root - correct)

ROOT CAUSE:
The v2/inventory.json file has an incorrect manifest entry for the v2 version. According to the root inventory:
- The file-4.txt in v2/content/ has the same digest (b3b26d26c9d8cfbb884b50e798f93ac6bef275a018547b1560af3e6d38f2723785731d3ca6338682fa7ac9acb506b3c594a125ce9d3d60cd14498304cc864cf2) as file-3.txt
- In the root inventory, both v2/content/file-4.txt and v1/content/file-3.txt are listed under this digest
- However, v2/inventory.json at v2 state only shows file-3.txt, not accounting for file-4.txt

Additionally, version-specific inventory files should include complete version chains, not just their own version or earlier versions.

RECOMMENDED FIXES
=================

1. UPDATE v1/inventory.json:
   - Update the "head" field from "v1" to "v3" to match root
   - Add v2 and v3 version blocks with their complete state information
   - Ensure manifest includes all files referenced by root inventory

2. UPDATE v2/inventory.json:
   - Update the "head" field from "v2" to "v3" to match root
   - In the manifest, ensure the digest pointing to file-4.txt shows both:
     "v2/content/file-4.txt" and "v1/content/file-3.txt"
   - In the v2 version state block, add file-4.txt alongside file-3.txt under the shared digest
   - Add the v3 version block to match root inventory
   - The v3 state should show file-1.txt, file-2.txt, file-3.txt, and file-4.txt

3. VERIFY v3/inventory.json:
   - The v2 state block should include both file-3.txt and file-4.txt with the same digest
   - Currently it only shows file-3.txt, which is inconsistent

GENERAL GUIDANCE:
According to OCFL specification, version-specific inventory files should be complete copies of the root inventory as of that version's creation. This ensures consistency and proper historical tracking. Each version directory's inventory.json should:
- Be identical to what the root inventory.json was at that version
- Include all versions up to and including that version
- Have the correct "head" pointer set to that version
- Have manifests that account for all content files present up to that point

The root inventory should represent the cumulative state of all versions, and version-specific copies should be snapshots of the root at each point in time.
