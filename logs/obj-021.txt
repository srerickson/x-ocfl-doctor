OCFL OBJECT VALIDATION REPORT
Object ID: obj-021
Validation Date: 2025-11-09
Status: INVALID

================================================================================
VALIDATION ERROR SUMMARY
================================================================================

Error Code: E066
Error Type: Digest Inconsistency
Severity: CRITICAL

The object failed validation due to digest (checksum) inconsistencies between
inventory files. The manifest in v1/inventory.json contains incorrect digest
values that do not match the actual file contents.

================================================================================
DETAILED ERROR ANALYSIS
================================================================================

Error Message:
"v1/inventory.json digests are inconsistent with other inventories: 1 error
occurred: * unexpected sha512 for "v1/content/file-1.txt":
"17e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1",
expected="07e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1""

Root Cause:
The v1/inventory.json file contains an incorrect SHA512 digest for file-1.txt
in its manifest section. This digest mismatch indicates that the inventory
metadata does not accurately reflect the actual content of the file.

Specific Issue:
- File: v1/content/file-1.txt
- Digest in v1/inventory.json (manifest):
  17e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1
- Actual file digest (computed):
  07e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1
- Difference: First character differs (1 vs 0)

Object Structure:
The object contains 2 versions (v1 and v2):
- v1 contains 3 files: file-1.txt, file-2.txt, file-3.txt
- v2 adds file-4.txt

Inventory Inconsistency:
- v1/inventory.json has incorrect digest (starts with "17e4...")
- v2/inventory.json (root inventory) has correct digest (starts with "07e4...")
- inventory.json (root-level copy) matches v2/inventory.json with correct digest

This indicates that v1/inventory.json was either manually edited incorrectly
or corrupted, while the root and v2 inventory files maintain consistency.

================================================================================
RECOMMENDED STEPS FOR FIXING THE OBJECT
================================================================================

Step 1: Backup the Current Object
  Command: cp -r /workspace/objects/obj-021 /workspace/objects/obj-021.backup
  Reason: Always maintain a backup before making corrections

Step 2: Correct the v1/inventory.json File
  The manifest entry for file-1.txt must be updated to use the correct digest.

  Change from:
    "17e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1": [
      "v1/content/file-1.txt"
    ]

  Change to:
    "07e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1": [
      "v1/content/file-1.txt"
    ]

  Also update the state section in v1 to use the correct digest:

  Change from:
    "17e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1": [
      "file-1.txt"
    ]

  Change to:
    "07e41ccb166d21a5327d5a2ae1bb48192b8470e1357266c9d119c294cb1e95978569472c9de64fb6d93cbd4dd0aed0bf1e7c47fd1920de17b038a08a85eb4fa1": [
      "file-1.txt"
    ]

Step 3: Update v1/inventory.json.sha512
  After correcting v1/inventory.json, recalculate its SHA512 checksum:

  Command: sha512sum /workspace/objects/obj-021/v1/inventory.json >
           /workspace/objects/obj-021/v1/inventory.json.sha512

  Reason: The .sha512 file must contain the correct checksum of the updated
          inventory file

Step 4: Verify Consistency with Root Inventory
  The root inventory.json already has the correct digest, so no changes should
  be needed there. However, verify that after fixing v1/inventory.json, all
  three inventory files (root, v1, and v2) are mutually consistent.

Step 5: Re-validate the Object
  Command: ocfl validate --object=objects/obj-021

  Expected output: No errors should be reported if all corrections are applied
                   correctly.

Step 6: Verify File Integrity
  After correction, confirm that the actual file content matches its digest:

  Command: sha512sum /workspace/objects/obj-021/v1/content/file-1.txt

  Expected output should begin with: 07e41ccb...

================================================================================
PREVENTION AND NOTES
================================================================================

This type of error typically occurs due to:
1. Manual editing of inventory files without recalculating digests
2. File corruption or accidental modifications
3. Incomplete or interrupted version updates
4. Incorrect use of OCFL tools or libraries

Best Practices to Prevent Future Issues:
- Use official OCFL libraries/tools to create and update objects
- Never manually edit inventory.json files; use the proper OCFL API
- Always verify digests after any object modification
- Maintain regular backups of OCFL objects
- Run validation checks after any update operation
- Document any custom modifications made to OCFL objects

================================================================================
