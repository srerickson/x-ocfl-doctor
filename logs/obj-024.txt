OCFL OBJECT VALIDATION REPORT
=====================================
Object ID: urn:example-2
Object Path: /workspace/objects/obj-024
Validation Date: 2025-11-09
Status: INVALID

VALIDATION ERROR
=====================================
Error Code: E046
Error Message: root inventory.json has missing version: v2

DETAILED ANALYSIS
=====================================

1. CORE ISSUE:
The root inventory.json file (at /workspace/objects/obj-024/inventory.json) has
a "head" pointing to "v1", but there are version directories for both v1 and v2
present in the object structure. Additionally, the v2/inventory.json file
references v2 in its versions object, creating an inconsistency.

2. CONFLICTING INVENTORY STATES:

Root inventory.json (/workspace/objects/obj-024/inventory.json):
- head: "v1"
- versions: Only contains v1
- Missing: v2 version definition

v2/inventory.json (/workspace/objects/obj-024/v2/inventory.json):
- head: "v2"
- versions: Contains both v1 and v2 definitions
- Issue: This is an internal version inventory that references v2, but the
         root inventory doesn't acknowledge v2

3. OBJECT STRUCTURE ISSUES:

Current Directory Structure:
- /workspace/objects/obj-024/
  - v1/
    - content/
      - test.txt
    - inventory.json
    - inventory.json.sha512
  - v2/
    - inventory.json (references v2, but no content directory)
    - inventory.json.sha512
  - inventory.json (root, only defines v1)
  - inventory.json.sha512
  - 0=ocfl_object_1.1

Problem: The v2 directory exists with an inventory.json, but:
1. The root inventory.json doesn't include v2 in its versions object
2. The v2 directory lacks a content directory
3. The v2 inventory references "test-2.txt" in the state, but no content files exist

4. OCFL SPEC VIOLATION:

According to OCFL 1.1 specification:
- The root inventory.json is the authoritative record of object versions
- All versions must be defined in the root inventory
- Version directories should contain actual content if referenced in state
- The "head" field in root inventory must match the highest version number that
  has been properly defined in the versions object

RECOMMENDED FIXES
=====================================

OPTION 1: Revert to single version object (Recommended if v2 was incomplete)
1. Delete the v2 directory entirely
2. Ensure root inventory.json has head: "v1"
3. Verify that v1 inventory and root inventory are in sync
4. Re-validate the object

OPTION 2: Complete the v2 version (If v2 was intended)
1. Update root inventory.json to include v2 in the versions object:
   - Set head: "v2"
   - Add v2 version entry with proper created, state, message, and user fields
2. Create /workspace/objects/obj-024/v2/content/ directory
3. Add the missing content file referenced in v2 state (test-2.txt)
4. Ensure inventory checksums are recalculated
5. Re-validate the object

OPTION 3: Sync all inventories
1. Ensure root inventory.json and v2/inventory.json are consistent
2. Make sure both files reference the same versions
3. Update checksums (inventory.json.sha512 files)
4. Re-validate the object

VALIDATION COMMAND
=====================================
To re-validate after fixes:
  ocfl validate --object /workspace/objects/obj-024

For verbose output:
  ocfl validate --object /workspace/objects/obj-024 --debug
